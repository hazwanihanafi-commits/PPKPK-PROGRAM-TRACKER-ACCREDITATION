<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PPKPK â€“ COPPA / SRR Appendix Dashboard</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#f4f6fb;
  padding:24px;
}

h2{
  margin-bottom:20px;
}

.area-card{
  background:#fff;
  border-radius:16px;
  padding:18px;
  margin-bottom:22px;
  box-shadow:0 6px 16px rgba(0,0,0,.08);
}

.area-title{
  font-size:18px;
  font-weight:bold;
  margin-bottom:14px;
  color:#1f2937;
}

.appendix-row{
  display:grid;
  grid-template-columns:90px 1fr 130px 1fr 90px;
  gap:10px;
  align-items:center;
  margin-bottom:8px;
  font-size:13px;
}

.appendix-row input{
  padding:6px 8px;
  border-radius:6px;
  border:1px solid #ccc;
}

.appendix-row button{
  padding:6px 10px;
  border-radius:6px;
  border:none;
  background:#2563eb;
  color:white;
  cursor:pointer;
}

.appendix-row button:hover{
  background:#1d4ed8;
}

.badge{
  padding:4px 10px;
  border-radius:14px;
  font-size:12px;
  text-align:center;
  font-weight:bold;
}

.NOT\ STARTED{
  background:#ffecec;
  color:#b00020;
}

.IN\ PROGRESS{
  background:#fff7cc;
  color:#8a6d00;
}

.COMPLETE{
  background:#e6fff0;
  color:#007a3d;
}

.progress{
  height:8px;
  background:#e5e7eb;
  border-radius:6px;
  overflow:hidden;
  margin-bottom:14px;
}

.progress div{
  height:100%;
  background:#22c55e;
}
</style>
</head>

<body>

<h2>ðŸ“˜ PPKPK â€“ COPPA / SRR Appendix Dashboard</h2>

<div id="coppaContainer"></div>

<script>
/* =========================
   CONFIG
========================= */
const APPENDIX_API =
"https://script.google.com/macros/s/AKfycbzzfNBLau1GPNucFLHvLUc_78B5M21SbE2AYYzbIA6QOLucZ8KDHQeAtM01U90V3kPvSw/exec";

/* =========================
   LOAD DATA
========================= */
async function loadCOPPA(){
  const res = await fetch(APPENDIX_API);
  const data = await res.json();

  const container = document.getElementById("coppaContainer");
  container.innerHTML = "";

  const grouped = {};
  data.forEach(r=>{
    if(!grouped[r.APPENDIX]) grouped[r.APPENDIX]=[];
    grouped[r.APPENDIX].push(r);
  });

  Object.keys(grouped).forEach(area=>{
    const rows = grouped[area];
    const total = rows.length;
    const completed = rows.filter(r=>r.STATUS==="COMPLETE").length;
    const percent = Math.round((completed/total)*100);

    const card = document.createElement("div");
    card.className="area-card";

    card.innerHTML = `
      <div class="area-title">${area}</div>
      <div class="progress"><div style="width:${percent}%"></div></div>
      <div style="font-size:13px;margin-bottom:12px">
        ${completed}/${total} COMPLETE (${percent}%)
      </div>
    `;

    rows.forEach(r=>{
      const row = document.createElement("div");
      row.className="appendix-row";

      row.innerHTML = `
        <div><b>${r["NO APPENDIX"]}</b></div>
        <div>${r.ITEM}</div>
        <div class="badge ${r.STATUS}">${r.STATUS}</div>
        <input id="link-${r["NO APPENDIX"]}"
          placeholder="Paste Google Drive link"
          value="${r.DOC_LINK || ""}">
        <button onclick="saveAppendix('${r["NO APPENDIX"]}')">
          Save
        </button>
      `;
      card.appendChild(row);
    });

    container.appendChild(card);
  });
}

/* =========================
   UPDATE APPENDIX
========================= */
async function saveAppendix(no){
  const link = document.getElementById(`link-${no}`).value;

  await fetch(APPENDIX_API,{
    method:"POST",
    body:JSON.stringify({
      appendix:no,
      status: link ? "COMPLETE" : "IN PROGRESS",
      doc_link: link
    })
  });

  loadCOPPA();
}

/* INIT */
loadCOPPA();
</script>

</body>
</html>
