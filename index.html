<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PPKPK â€“ Programme Accreditation Dashboard</title>

<style>
body{
  font-family:Inter, Arial, sans-serif;
  background:#f6f8fb;
  padding:24px;
}

h1{
  margin-bottom:20px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(360px,1fr));
  gap:20px;
}

.card{
  background:white;
  border-radius:18px;
  padding:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.card h3{
  margin:0;
}

.sub{
  color:#666;
  font-size:14px;
  margin-bottom:10px;
}

.badge{
  display:inline-block;
  padding:4px 12px;
  border-radius:20px;
  font-size:12px;
  margin-bottom:12px;
}

.ready{background:#e6fff0;color:#047857}
.notready{background:#ffecec;color:#b00020}

.progress-wrap{
  display:flex;
  gap:16px;
  align-items:center;
}

.ring{
  width:90px;
  height:90px;
}

.ring circle{
  fill:none;
  stroke-width:8;
  stroke-linecap:round;
}

.ring-bg{stroke:#e5e7eb}
.ring-val{stroke:#22c55e}

.percent{
  font-weight:bold;
  font-size:18px;
}

.meta{
  font-size:14px;
  margin-top:6px;
}

button{
  margin-top:14px;
  padding:8px 14px;
  border-radius:10px;
  border:1px solid #ccc;
  background:white;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>ðŸ“˜ PPKPK â€“ Programme Accreditation Dashboard</h1>

<div class="grid" id="grid"></div>

<script>
const API =
"https://script.google.com/macros/s/AKfycbzzfNBLau1GPNucFLHvLUc_78B5M21SbE2AYYzbIA6QOLucZ8KDHQeAtM01U90V3kPvSw/exec";

async function load(){
  const res = await fetch(API);
  const data = await res.json();

  const programs={};

  data.forEach(r=>{
    const p=r["ACADEMIC PROGRAM"];
    if(!p) return;

    if(!programs[p]){
      programs[p]={
        academic:p,
        bm:r["PROGRAM AKADEMIK"],
        total:0,
        done:0
      };
    }

    programs[p].total++;
    if(r.STATUS==="COMPLETE") programs[p].done++;
  });

  const grid=document.getElementById("grid");

  Object.values(programs).forEach(p=>{
    const percent=Math.round((p.done/p.total)*100)||0;
    const ready=percent===100;
    const r=36;
    const c=2*Math.PI*r;
    const offset=c-(percent/100)*c;

    grid.innerHTML+=`
      <div class="card">
        <h3>${p.academic}</h3>
        <div class="sub">${p.bm||""}</div>

        <div class="badge ${ready?"ready":"notready"}">
          ${ready?"READY":"NOT READY"}
        </div>

        <div class="progress-wrap">
          <svg class="ring" viewBox="0 0 100 100">
            <circle class="ring-bg" cx="50" cy="50" r="${r}"/>
            <circle class="ring-val"
              cx="50" cy="50" r="${r}"
              stroke-dasharray="${c}"
              stroke-dashoffset="${offset}"
              transform="rotate(-90 50 50)"/>
          </svg>

          <div>
            <div class="percent">${percent}% Complete</div>
            <div class="meta">${p.done} / ${p.total} appendix completed</div>
          </div>
        </div>

        <button onclick="openProgram('${encodeURIComponent(p.academic)}')">
          View Programme Dashboard
        </button>
      </div>
    `;
  });
}

function openProgram(name){
  window.location.href=
    "programme.html?program="+name;
}

load();
</script>

</body>
</html>
